---
layout: post
title: js 实现评分组件
categories: [功能实现]
description: js 实现评分组件
keywords: js 实现评分组件
---

# 背景
用户对某一次的服务是否满意程度，很常见的一种需求。

## 为什么要自己实现她
从前遇到这样的需求的时候，都是直接找插件，或者是框架，那样的话，动动手指头就可以了。so easy。。。。

可是这次不行了，整个项目我使用的是原生开发，没有引用任何的插件or框架，纯粹的css，js，html，就因为一个小小的评分的需求，我就去引入一个js或者框架的，未免有些浪费。更何况我的代码是要交给别的同事，我用框架啥的会限制对方，这并不是一个好的选择。功能并非很难，完全可以自己实现的

## 代码实现
需求：鼠标移动到第几个星星，他前面的所有星星都高亮，若是移动到某个星星的1/2之前就是高亮半颗星星

![]({{ site.url }}/images/star.gif)

实现思路：

1. 每个星星都是可以点击的，星星数量不一定 => 使用 i 标签循环展示星星的数量

```
<i class="iconfont icon-star star" aria-hidden="true"></i>
```

2. 鼠标移动上去的高亮到当前的星星 => a.记录局部当前移动到第几个星星和当前星星的位置;b.前面的星星都高亮，根据当前星星的位置判断是半个还是一颗
```
let storage = undefined;  // 点击的时候记录当前点击的位置
let sign = false; // 标记当前是否是半颗星，false 不是半星，true 为半星
  stars[i].setAttribute("index", i);

  stars[i].onmousemove = function (e) {
    let currIndex = this.getAttribute("index");
    let currSign = starHalf(e.offsetX, this.offsetWidth)
    starLight(stars, currIndex, currSign)
  }
```

3. 鼠标离开的时候，查找全局的记录星星信息的位置，添加指定样式

```
stars[i].onmouseleave = function (e) {
  
  starLight(stars, storage, sign)
}
```

4. 点击的时候，把当前的位置信息记录到全局

```
stars[i].onclick = function (e) {
  storage = this.getAttribute("index");
  sign = starHalf(e.offsetX, this.offsetWidth)
}
```

5. 收工完成

```
/**
	 * 是否是半星
	 * @param {currWidth} 一个星星最左边到鼠标位置的长度
	 * @param {halfWidth} 一个星星一半的长度
	 * @return {boolean} true 是半星，false 不是半星
	 */
	function starHalf(currWidth, halfWidth) {
		return currWidth <= halfWidth / 2 ? true : false
	}

	/**
	 * 点亮星星
	 * @param {object} elem 星星数组元素
	 * @param {number} index 最多需要点亮多个星星
	 * @param {boolean} sign 是否是半星，true 是半星，false 不是半星
	 */
	function starLight(elem, index, sign) {
		for (let i = 0; i < elem.length; i++) {
			elem[i].className = i <= index ? "iconfont icon-start-copy" : "iconfont icon-star";
		}
		if (sign) {
			elem[index].className = " iconfont icon-banxing1";
		}
	}
```

[原生评分预览](https://codepen.io/qingchuang/pen/dypNyLP)

## 总结
最开始的时候，我的思路没有理清楚，想了半天，绕了半天的弯路。后来重新理理思路，发现不难。

