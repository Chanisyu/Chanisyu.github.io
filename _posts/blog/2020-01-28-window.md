
---
layout: post
title: 获取元素位置的一些方法
categories: [JavaScript]
description: JavaScript
keywords: JavaScript
---

# 获取元素位置的一些方法
把所有获取元素或者window位置的方法总结一下，方便下一次查找

## 获取元素位置大小的方法

[Element.getBoundingClientRect()](https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect): 获取元素在可视区域中位置

![]({{ site.url }}/images/boundingClientRect.png)


[Window.pageYOffset](https://developer.mozilla.org/en-US/docs/Web/API/Window/pageYOffset) 和[Window.scrollY](https://developer.mozilla.org/en-US/docs/Web/API/Window/scrollY) 两者的意思是一样的，获取window的滚动距离。桌面端和移动端的窗体滚动元素是不一样的，对于窗体元素是body或者html的时候，我们使用document.scrollingElement.scrollTop来获取滚动的距离。如果滚动元素不是窗体，那么滚动的距离永远是0

[clientHeight](https://developer.mozilla.org/en-US/docs/Web/API/Element/clientHeight):/clientWidth元素的内部高/宽度，只包括padding，其余的都不包括

[Element.scrollHeight](https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollHeight): 滚动元素的高度，只包括padding，不管元素是否被隐藏，都返回元素的实际占据的高度

[HTMLElement.offsetLeft](https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetLeft): 当前元素（width+padding-left）距离body左边的宽度=>相当于当前元素的margin-left/+border-left+祖先的padding-left+margin-left+border-left 层层相加的结果

[HTMLElement.offsetHeight](https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetHeight): width+padding+border的宽高度
![]({{ site.url }}/images/offsetHeight.png)

## 页面加载的事件
1. 当纯HTML被完全加载以及解析时

[DOMContentLoaded](https://developer.mozilla.org/zh-CN/docs/Web/API/Document/DOMContentLoaded_event):当纯HTML被完全加载以及解析时，DOMContentLoaded 事件会被触发，而不必等待样式表，图片或者子框架完成加载。

2. 页面所有的资源加载完成
[load](https://developer.mozilla.org/zh-CN/docs/Web/Events/load):当整个页面及所有依赖资源如样式表和图片都已完成加载时，将触发load事件。它与DOMContentLoaded不同，后者只要页面DOM加载完成就触发，无需等待依赖资源的加载。

## 获取某一个元素的样式表
[Window.getComputedStyle()](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/getComputedStyle):返回一个样式对象，里面包含了所有的样式，要看某一个样式比如层级`xx.zIndex`就可以了

## 获取最近的最先元素
[closest](https://developer.mozilla.org/zh-CN/docs/Web/API/Element/closest):匹配特定选择器且离当前元素最近的祖先元素（也可以是当前元素本身）。如果匹配不到，则返回 null。

## 判断元素是否可聚焦
[tabindex](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Global_attributes/tabindex):指示其元素是否可以聚焦，以及它是否/在何处参与顺序键盘导航。

tabindex=负值 (通常是tabindex=“-1”)，表示元素是可聚焦的，但是不能通过键盘导航来访问到该元素，用JS做页面小组件内部键盘导航的时候非常有用。

tabindex="0" ，表示元素是可聚焦的，并且可以通过键盘导航来聚焦到该元素，它的相对顺序是当前处于的DOM结构来决定的。

tabindex=正值，表示元素是可聚焦的，并且可以通过键盘导航来访问到该元素；它的相对顺序按照tabindex 的数值递增而滞后获焦。如果多个元素拥有相同的 tabindex，它们的相对顺序按照他们在当前DOM中的先后顺序决定。

问： 如果dom元素无法响应focus状态，则设置该DOM元素的tabindex属性值为0，这样就能被focus了。如果原本就可以响应focus状态，则不处理。

```
if (dom.tabIndex == -1 && dom.getAttribute('tabindex') != '-1') {
    dom.tabIndex = 0;
}
```

## 节点操作
[document.createTreeWalker()](https://developer.mozilla.org/zh-CN/docs/Web/API/Document/createTreeWalker): 创建一个[TreeWalker](https://developer.mozilla.org/zh-CN/docs/Web/API/TreeWalker)

[ChildNode.replaceWith()](https://developer.mozilla.org/zh-CN/docs/Web/API/ChildNode/replaceWith):替换了该节点父节点下的子节点

```
<p id="p">访问<strong>此<a href="##">链接</a></strong>。</p>
function text2html(p) {
  [].slice.call(p.childNodes).forEach(function(node) {
    if(node.nodeType == 3) {
      var replaceArr = node.textContent.split('').map(function(str) {
        var newSpan = document.createElement('span');
        newSpan.textContent = str;
        return newSpan;
      });
      node.replaceWith.apply(node, replaceArr);
    } else if(node.nodeType === 1) {
      text2html(node);
    }
  });
}

或者：
function text2html(element) {
  var treeWalker = document.createTreeWalker(element, NodeFilter.SHOW_TEXT);
  var node;
  const list = []
  while ((node = treeWalker.nextNode())) {
    list.push(node)
  }
  for(let node of list){
    for (let char of node.data) {
      const span = document.createElement("span");
      span.textContent = char;
      node.parentNode.insertBefore(span, node);
    }
    node.parentNode.removeChild(node)
  }
}
```

