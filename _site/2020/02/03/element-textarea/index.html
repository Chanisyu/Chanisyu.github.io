<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title> 如何实现一个可编辑的文本输入框，元素的高度随着内容的改变而自动改变 &mdash; sunseekers</title><link rel="stylesheet" href="http://localhost:4000/assets/vendor/primer-css/css/primer.css" /><link rel="stylesheet" href="http://localhost:4000/assets/css/components/collection.css" /><link rel="stylesheet" href="http://localhost:4000/assets/css/components/repo-card.css" /><link rel="stylesheet" href="http://localhost:4000/assets/css/sections/repo-list.css" /><link rel="stylesheet" href="http://localhost:4000/assets/css/components/boxed-group.css" /><link rel="stylesheet" href="http://localhost:4000/assets/css/globals/common.css" /><link rel="stylesheet" href="http://localhost:4000/assets/css/globals/responsive.css" /><link rel="stylesheet" href="http://localhost:4000/assets/css/posts/index.css" /><link rel="stylesheet" href="http://localhost:4000/assets/vendor/octicons/octicons/octicons.css" /><link rel="stylesheet" href="https://mazhuang.org/rouge-themes/dist/github.css" /><link rel="canonical" href="http://localhost:4000/2020/02/03/element-textarea/" /><link rel="alternate" type="application/atom+xml" title="sunseekers" href="http://localhost:4000/feed.xml" /><link rel="shortcut icon" href="http://localhost:4000/favicon.ico" /><meta property="og:title" content="如何实现一个可编辑的文本输入框，元素的高度随着内容的改变而自动改变" /><meta name="keywords" content="移动端" /><meta name="og:keywords" content="移动端" /><meta name="description" content="用什么实现可编辑的文本输入框" /><meta name="og:description" content="用什么实现可编辑的文本输入框" /><meta property="og:url" content="http://localhost:4000/2020/02/03/element-textarea/" /><meta property="og:site_name" content="sunseekers" /><meta property="og:type" content="article" /><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2020-02-03" /> <script src="http://localhost:4000/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="http://localhost:4000/assets/js/jquery-ui.js"></script> <script src="http://localhost:4000/assets/js/main.js"></script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1> <a href="http://localhost:4000/" title="sunseekers" ><span class="octicon octicon-mark-github"></span> sunseekers</a ></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();" > <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="http://localhost:4000/" class=" site-header-nav-item" target="" title="首页" >首页</a > <a href="http://localhost:4000/categories/" class=" site-header-nav-item" target="" title="分类" >分类</a > <a href="http://localhost:4000/wiki/" class=" site-header-nav-item" target="" title="维基" >维基</a > <a href="http://localhost:4000/links/" class=" site-header-nav-item" target="" title="链接" >链接</a > <a href="http://localhost:4000/about/" class=" site-header-nav-item" target="" title="关于" >关于</a ></nav></div></header><style> html.dark-mode, html.dark-mode img { filter: invert(1) hue-rotate(180deg); } html.dark-mode img { opacity: 0.85; } #darkContainer { position: fixed; bottom: 50px; left: 100px; display: flex; } #darkContainer .text { margin-right: 8px; } #darkContainer .switch-btn { user-select: none; display: inline-block; width: 50px; border: none; height: 25px; border-radius: 50px; background: rgba(0, 0, 0, 0.25); cursor: pointer; transition: all 0.2s; position: relative; outline: none; } #darkContainer .switch-btn.switch-btn-checked { background: #1890ff; } #darkContainer .switch-btn .switch-handle { height: 20px; width: 20px; background: #fff; border-radius: 50%; position: absolute; top: 2px; left: 4px; transition: all 0.2s ease-in-out; } #darkContainer .switch-btn.switch-btn-checked .switch-handle { left: calc(100% - 22px); }</style><script> let isDarkMode = localStorage.getItem('isDarkMode'); if (isDarkMode === 'true') { document.firstElementChild.classList.add('dark-mode'); } </script> <script defer> const darkContainer = document.createElement('div'); darkContainer.id = 'darkContainer'; darkContainer.innerHTML = `<span class="text">深色模式</span>`; const btnEl = document.createElement('button'); btnEl.classList.add('switch-btn'); btnEl.innerHTML = `<div class="switch-handle"></div>`; if (isDarkMode === 'true') { btnEl.classList.add('switch-btn-checked'); } btnEl.addEventListener('click', (e) => { if (btnEl.classList.contains('switch-btn-checked')) { btnEl.classList.remove('switch-btn-checked'); document.firstElementChild.classList.remove('dark-mode'); localStorage.setItem('isDarkMode', 'false'); } else { btnEl.classList.add('switch-btn-checked'); document.firstElementChild.classList.add('dark-mode'); localStorage.setItem('isDarkMode', 'true'); } }); darkContainer.append(btnEl); document.body.appendChild(darkContainer); </script></body></html><section class="collection-head small geopattern" data-pattern-id="如何实现一个可编辑的文本输入框" ><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">如何实现一个可编辑的文本输入框，元素的高度随着内容的改变而自动改变</h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2020/02/03 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="http://localhost:4000/categories/#功能实现" title="功能实现" >功能实现</a > </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 3224 字，约 10 分钟 </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths"><article class="article-content markdown-body"><h1 id="用什么实现可编辑的文本输入框">用什么实现可编辑的文本输入框</h1><p>我们是用用 <code class="language-plaintext highlighter-rouge">textarea</code> 高度随着内容的改变而自动改变，还是用 <code class="language-plaintext highlighter-rouge">div</code> 模拟 <code class="language-plaintext highlighter-rouge">textarea</code>呢？ 两者都能实现，实现原理似乎不太一样，选用哪一个，就要看产品的需求和哪一个需要填的坑最少了。在一次开发中兜兜转转，我最后选择了用 <code class="language-plaintext highlighter-rouge">textarea</code> ，原因和之前的项目保持一致的风格。还是那句老话，如果在项目中有很多地方需要使用，可以考虑使用一个公共的组件库，后期代码维护方便。如果是一个团队的多个项目中使用，可以写成一个公共的 <code class="language-plaintext highlighter-rouge">UI</code> 库，通过 <code class="language-plaintext highlighter-rouge">npm</code> 安装使用。</p><h2 id="需求">需求</h2><p>根据输入内容自动撑开元素的高度，避免滚动条里面嵌套滚动条的尴尬局面。如果文本输入框元素后面有元素会被自动挤下去，整体的体验应该算是挺不错的，所有内容通过一个滚动就可以展示完</p><h3 id="textarea-是什么"><code class="language-plaintext highlighter-rouge">textarea</code> 是什么</h3><p>一个文本输入框，一个可以无限输入内容的标签，文字超出高度，会自动有一个滚动条。在工作中用的比较少，第一时间想到 <code class="language-plaintext highlighter-rouge">textarea</code> ，可是在网上都是看到通过 <code class="language-plaintext highlighter-rouge">cols</code> 去控制行高，还有丑丑的滚动条，高度要实时控制，需要去监听输入内容变化，一变化就改变 <code class="language-plaintext highlighter-rouge">cols</code> 的大小，我无法知道用户输入的是换行还是字符串，什么时候进行 <code class="language-plaintext highlighter-rouge">cols</code> 的大小变化，我不知道怎么去判断？开始要放弃 <code class="language-plaintext highlighter-rouge">textarea</code></p><h3 id="div-模拟-textarea"><code class="language-plaintext highlighter-rouge">div</code> 模拟 <code class="language-plaintext highlighter-rouge">textarea</code></h3><p>后来想到用 <code class="language-plaintext highlighter-rouge">div</code> 模拟 <code class="language-plaintext highlighter-rouge">textarea</code>，设置 <code class="language-plaintext highlighter-rouge">contenteditable=“true”</code> , 那么 <code class="language-plaintext highlighter-rouge">placeholder</code> 怎么模拟？ 查询一番找到了解决方案</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   .textarea:empty:before {
      content: attr(placeholder);
      color: rgba(144, 144, 144, 1);
      line-height: 24px;
    }
    .textarea:focus:before {
      content: none;
    }
</code></pre></div></div><p>这个可以完美的实现，问题又来了，在 <code class="language-plaintext highlighter-rouge">IOS</code>,底下不能编辑，头疼，解决方案 <code class="language-plaintext highlighter-rouge">-webkit-user-select: text;</code> 。好像问题都解决了，其实并没有，安卓或者 <code class="language-plaintext highlighter-rouge">IOS</code> 在聚焦的时候第一次总是没法聚焦，要点两次，解决方案，加一段代码</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  // 解决焦点聚焦时候的问题
  let textarea = this.$refs.textarea
  textarea.focus()
  if (typeof window.getSelection !== 'undefined' &amp;&amp;
    typeof document.createRange !== 'undefined') {
    var range = document.createRange()
    range.selectNodeContents(textarea)
    range.collapse(false)
    var sel = window.getSelection()
    sel.removeAllRanges()
    sel.addRange(range)
  } else if (typeof document.body.createTextRange !== 'undefined') {
    var textRange = document.body.createTextRange()
    textRange.moveToElementText(textarea)
    textRange.collapse(false)
    textRange.select()
  }
</code></pre></div></div><p>这一次我以为完美实现了。让我崩溃的事再一次发生了，在提测前几个小时，模拟的输入框，每一次换行都会被一个 <code class="language-plaintext highlighter-rouge">div</code> 标签包着，而且我获取到的内容是带有标签的（<code class="language-plaintext highlighter-rouge">span,br</code>),这个导致的直接不好影响就是，所用用我并不知道哪些人会用，麻烦太大了。后来我又发现可以通过使用 <code class="language-plaintext highlighter-rouge">-webkit-user-modify: read-write-plaintext-only;"</code> 进行控制，让只能输入纯文本，问题是解决了。</p><p>目前自测过程中发现了几个小问题，都慢慢的解决了。关于手机的兼容性，只是简单的对比了<code class="language-plaintext highlighter-rouge">ios</code> 和安卓两个系统，还有更多机型没有仔细测试。</p><p>这一篇文章写的蛮好的，<a href="https://www.zhangxinxu.com/wordpress/2016/01/contenteditable-plaintext-only/">小 tip: 如何让 contenteditable 元素只能输入纯文本</a></p><p><a href="https://juejin.im/post/5d5003396fb9a06b265088c0">contenteditable 跟 user-modify 还能这么玩</a></p><h3 id="回头再来看看-textarea">回头再来看看 <code class="language-plaintext highlighter-rouge">textarea</code></h3><p>提测以后我继续和对桌交流我的迷惑，因为<code class="language-plaintext highlighter-rouge">div</code> 模拟 <code class="language-plaintext highlighter-rouge">textarea</code>，不知道有多少坑等着我去踩，对桌说了一句是标签就有 <code class="language-plaintext highlighter-rouge">height</code> 这些属性。在我的潜意识里面居然忽略了这个，一语点醒梦中人</p><p>最后，又回到最初的起点，呆呆的看着电脑屏幕，我都是在干了一些什么事？</p><p>继续研究用 <code class="language-plaintext highlighter-rouge">textarea</code>，实现，发现了利用 <code class="language-plaintext highlighter-rouge">Element.scrollHeight</code> 这个只读属性可以实现（一个元素内容高度的度量，包括由于溢出导致的视图中不可见内容。）</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &lt;textarea maxlength='1000' ref="textarea" class='textarea' v-model='sendContent' placeholder="请输入文本内容……" @input="resizeHeight"&gt;


    // 函数节流，不实时改变数据
     function throttle (fn, interval = 300) {
      let canRun = true
      return function () {
        if (!canRun) return
        canRun = false
        setTimeout(() =&gt; {
          fn.apply(this, arguments)
          canRun = true
        }, interval)
      }
    },
    created(){
      //函数节流，需要先执行一次，形成必包。如果在methods里面，每一次调用都是生成新的函数，没有节流的效果
      this.resizeHeight = this.throttle(this.resize, 1000)()
    }

    resize () {
      let text = this.$refs.textarea
      text.style.height = 'auto'
      text.style.height = text.scrollHeight + 'px'
    },

    //去掉默认样式
      overflow-y: hidden;
      outline: none;
      resize: none;
      border: none;
</code></pre></div></div><p>有网友说这个还有一个弊端:”终端数据是 <code class="language-plaintext highlighter-rouge">socket</code> 返回的 有时候设置高度有点不对 而且聚焦的时候滚动条会跳到最顶端 还有好多其他的问题” 我的数据不是 <code class="language-plaintext highlighter-rouge">socket</code> 返回的，所以这一点我不知道会不会影响</p><p>注意了：当我们设置了 <code class="language-plaintext highlighter-rouge">textarea</code> 的 <code class="language-plaintext highlighter-rouge">display</code> 时候，在 <code class="language-plaintext highlighter-rouge">IOS</code> 下面字体颜色灰蒙蒙的，尝试过给 <code class="language-plaintext highlighter-rouge">textarea:dispay</code> 添加属性，去修改字体的颜色，但是好像都失效了 。最后改用了 <code class="language-plaintext highlighter-rouge">readonly</code> 去实现，需要加下面一段代码，否则会有光标在那显示</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[readonly="readonly"] {
  user-select: none;
}
</code></pre></div></div><h2 id="white-space"><code class="language-plaintext highlighter-rouge">white-space</code></h2><p>或许你都没有听说过这个属性，但是在关键时刻很好用，是他帮助我解决了一个很大的难题。前面说到过 <code class="language-plaintext highlighter-rouge">div</code> 模拟 <code class="language-plaintext highlighter-rouge">textarea</code>。如果是用 <code class="language-plaintext highlighter-rouge">div</code> 单纯的去显示 <code class="language-plaintext highlighter-rouge">textarea</code> 内容，在 <code class="language-plaintext highlighter-rouge">vue</code> 中可以用 <code class="language-plaintext highlighter-rouge">v-html</code> 去渲染，但是如果接口返回的数据把换行转成是一个空格，这时候如果我们没有进行处理的话，换行会失效。可以选择用 <code class="language-plaintext highlighter-rouge">js</code> 进行处理，但是没必要，因为 <code class="language-plaintext highlighter-rouge">css</code> 可以解决。<code class="language-plaintext highlighter-rouge">white-space: pre-wrap;</code> 解决，就是这么简单。我遇到这个问题，向我领导求助，他能够分分钟想到这个属性，或许这就是大佬佩服佩服。以后碰到空格要换行展示，用它就行了。开心，又学到新的东西</p><h3 id="总结">总结</h3><p>或许还有更多更好的实现方式，多个脑袋总会比一个脑袋好用，欢迎大家和我交流。兜兜转转最后我还是选择了使用 <code class="language-plaintext highlighter-rouge">textarea</code> ，转了一个那么大的圈，回到最初，只想说，革命尚未成功，同志仍需努力。我发现了自己以前写东西都是用别人写好的 <code class="language-plaintext highlighter-rouge">ui</code> 库，却不曾去思考人家底层是如何实现的？是不是还有其他的实现方式？如果是我会怎么去实现？哎说到底还是自己太菜了，往后余生，请多多关照，多多学习，不要再继续这么菜了</p></article><div style="padding-top:20px;"><hr /><p>有时候，虽然素未谋面。却已相识很久，很微妙也很知足。在逝去的岁月里，我们在某一刻，共同经历着一样的情愫。</p><p>如果喜欢我的话，我们可以互相关注，相互学习的哟！互相鼓励，你的关注是我最大的动力来源</p><a href="https://github.com/sunseekers">sunseekers</a></div><div><div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"><h3>文档信息</h3><ul><li>本文作者：<a href="http://localhost:4000" target="_blank">sunseekers</a></li><li>本文链接：<a href="http://localhost:4000/2020/02/03/element-textarea/" target="_blank">http://localhost:4000/2020/02/03/element-textarea/</a></li><li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">创意共享3.0许可证</a>）</li></ul></div></div><div class="share"></div><div class="comment"><div id="gitalk-container"></div><link rel="stylesheet" href="http://localhost:4000/assets/vendor/gitalk/gitalk.css"> <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> <script> var gitalk = new Gitalk({ id: '/2020/02/03/element-textarea/', clientID: '', clientSecret: '', repo: '', owner: '', admin: [''], labels: ['gitment'], perPage: 50, }); gitalk.render('gitalk-container'); </script></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width:96%" type="text" id="search_box" placeholder="Search"></div><ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul><script src="http://localhost:4000/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: 'http://localhost:4000/assets/search_data.json', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 10, fuzzy: false, exclude: ['Welcome'] }) </script><h3 class="post-directory-title mobile-hidden">Table of Contents</h3><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="http://localhost:4000/assets/js/jquery.toc.js"></script></div></div></section><footer class="container"><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2016 <span title="sunseekers">sunseekers</span> <a href="javascript:window.scrollTo({behavior: 'smooth', top: 0})" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo({behavior: 'smooth', top: 0})" >TOP</a></li></ul><a href="https://github.com/sunseekers/sunseekers.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="http://localhost:4000/" title="首页" target="">首页</a></li><li> <a href="http://localhost:4000/categories/" title="分类" target="">分类</a></li><li> <a href="http://localhost:4000/wiki/" title="维基" target="">维基</a></li><li> <a href="http://localhost:4000/links/" title="链接" target="">链接</a></li><li> <a href="http://localhost:4000/about/" title="关于" target="">关于</a></li><li><a href="http://localhost:4000/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a></div><script src="http://localhost:4000/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script></body></html>
